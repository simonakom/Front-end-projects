<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table of Products</title>
    <!-- Boostrap CDN(content delivery network) & Javascript) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <style>
        body {
            background-color:rgba(215, 211, 207, 0.248);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .logo {
            height: 15vh;  
        }
        .data{
            font-size: 40px;
            color: #d6a10e;
            font-weight:600;
        }
        #submit {
            background-color: #fcb800;
            color: rgb(73, 71, 71);
        }
        #submit:hover {
        transform: scale(1.1);
        transition: transform 0.3s ease-in-out;
        background-color: #fcb800;
        color:white;
        opacity: 0.8;
        }
        #delete {
            background-color: rgba(179, 27, 47, 0.612);
            color:white;
        }
        #delete:hover {
        transform: scale(1.1);
        transition: transform 0.3s ease-in-out;
        background-color: rgb(180, 20, 63);
        color:white;
        opacity: 0.8;
        }
        #update {
            background-color: rgba(122, 87, 122, 0.56);
            color:white;
        }
        #update:hover {
        transform: scale(1.1);
        transition: transform 0.3s ease-in-out;
        background-color: rgba(161, 89, 161, 0.791);
        color:white;
        opacity: 0.8;
        }
        .add-result {
        display: none;
        background-color: #cf7a847f;
        color:  rgb(255, 255, 255);
        border-radius: 20px;
        padding: 10px;  
        max-width:40%;   
        margin: auto;
        }
        #delete {
            gap: 20px;
        }



        
        @media screen and (max-width: 768px) {    
        img {
        width: 30%;
        }   
        .d-flex {
        flex-direction: column;
        align-items: center;
        }
        .gap-4 {
        gap: 0!important
        }

        form {
            margin: auto;
        } 
        }

        @media screen and (max-width: 570px) {    
        form {
           width:  100%;
           margin-left: 40px;
        }
        }  
    </style>
</head>
<body>
    <!-- html kodas skirtas CRUD -->
    <div class="container text-center mx- my-3">
        <div><img src="gift.png" class="logo my-3"></div>
        <p class="data mb-5">Data Table</p>
        <p class="add-result mb-4" id="add-result"></p>
        <form>
            <div class="row">
                <div class="d-flex gap-4">
                    <div class="input-group mb-3">
                        <span class="title input-group-text" id="basic-addon1">Product</span>
                        <input type="text" id="title" name="title" class="form-control" placeholder="Type text..." aria-label="Username" aria-describedby="basic-addon1">
                    </div>
    
                    <div class="input-group mb-3">
                        <span class="price input-group-text" id="basic-addon1">Price</span>
                        <input type="text" id="price" name="price" class="form-control" placeholder="Type number..." aria-label="Username" aria-describedby="basic-addon1">
                    </div>

                    <div class="input-group mb-3">
                        <span class="stock input-group-text" id="basic-addon1">Stock</span>
                        <input type="text" id="stock" name="stock" class="form-control" placeholder="Type number..." aria-label="Username" aria-describedby="basic-addon1">
                    </div>
                </div>

                <div class="d-flex gap-4">
                    <div class="input-group mb-3">
                        <span class="brand input-group-text" id="basic-addon1">Brand</span>
                        <input type="text" id="brand" name="brand" class="form-control" placeholder="Type text..." aria-label="Username" aria-describedby="basic-addon1">
                    </div>

                    <div class="input-group mb-3">
                        <label class="input-group-text" for="category">Category</label>
                        <select class="form-select" id="category" name="category">
                        <option disabled selected>Choose...</option>
                        <option value="smartphones">Smartphones</option>
                        <option value="laptops">Laptops</option>
                        <option value="fragrances">Fragrances</option>
                        <option value="skincare">Skincare</option>
                        <option value="groceries">Groceries</option>
                        <option value="home-decoration">Home-decoration</option>
                        </select>
                    </div>

                    <div class="input-group mb-3">
                        <span class="imageUrl input-group-text" id="basic-addon1">Image</span>
                        <input type="text" id="imageUrl" name="mageUrl" class="form-control" placeholder="Type text..." aria-label="Username" aria-describedby="basic-addon1">
                    </div>
                </div>

                <div class="d-flex gap-4">
                    <div class="input-group mb-3">
                        <span class="discount input-group-text" id="basic-addon1">Discount</span>
                        <input type="number" min="0" max="100" value="0" id="discount" name="discount" class="form-control" placeholder="" aria-label="Username" aria-describedby="basic-addon1">
                    </div>

                    <div class="input-group mb-3">
                        <span class="rating input-group-text" id="basic-addon1">Rating</span>
                        <input type="number" min="0" max="5" value="0" id="rating" name="rating" class="form-control" placeholder="" aria-label="Username" aria-describedby="basic-addon1">
                    </div>
                </div>

                <div class="form-floating">
                    <textarea name="description" id="description" class="form-control mb-4" placeholder="Leave a comment here" id="floatingTextarea"></textarea>
                    <label for="description" class="mx-2">&nbsp&nbsp Product Description</label>
                </div>
               
                <div><button type="button" class="btn btn-default px-5" id="submit">Submit</button></div> 
            </div>
        </form>

        <table class=" table table-light table-hover table-bordered my-5">
            <thead>
                <tr class="table-dark">
                    <th>#</th>
                    <th>Product Name</th>
                    <th>Price</th>
                    <th>Stock</th>
                    <th>Brand</th>
                    <th>Category</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="dynamic-data">
                <tr> 
                    <!-- sita eilute buna perrasoma per "for" ir yra nereikalinga  -->
                    <td>EXAMPLE</td>
                    <td>Apple Product</td>
                    <td>1.50</td>
                    <td>40</td>
                    <td>Apple</td>
                    <td>Groceries</td>
                </tr>
            </tbody>
        </table>
    </div>
      
    <dialog id="productInfo" style="width: 70%">
        <div style="max-width: 70%; margin: 0 auto;">
            <img src="https://i.dummyjson.com/data/products/1/thumbnail.jpg" alt="Product photo"/>
            <div class="product-details">
                <div class="row">
                    <span class="col-2 fw-bold">Discount</span>
                    <span class="col-1">10%</span>
                </div>
                <div class="row">
                    <span class="col-2 fw-bold">Rating</span>
                    <span class="col-1">4.23</span>
                </div>
                <div class="row">
                    <span class="col-2 fw-bold">Description</span>
                    <span class="col-6">Lorem, ipsum dolor sit amet consectetur adipisicing elit. Ea itaque aliquid odit quod repellendus natus iste et, esse eaque animi unde praesentium earum vitae similique nihil explicabo corrupti assumenda totam numquam, excepturi tenetur? Hic velit nihil fugit. Qui, voluptas molestias.</span>
                </div>
            </div>
        </div>
    </dialog>


    <script>
        console.log(localStorage.getItem("products"));
        if (!localStorage.getItem("products")) {  //jei false, tada sukuriame nauja irasa localstorage
            localStorage.setItem("products", JSON.stringify([]));
        }


        const products = JSON.parse(localStorage.getItem("products"));
        let currentId = 1; //dabartine numeracija, prasideda nuo 1


        // Priega prie kintamuju is scripto "products": console.log (products);
        // JS kodas skirtas atlikti CRUD veiksmams;
        // Produktu atvaizdavimas yra per JS - atvaizduojami html tbody;

        // elementu paemimas:
        const dynamicDataElement = document.getElementById("dynamic-data"),
			    titleInputElement = document.getElementById("title"),
				priceInputElement = document.getElementById("price"),
				stockInputElement = document.getElementById("stock"),
				brandInputElement = document.getElementById("brand"),
				categoryInputElement = document.getElementById("category"),
				submitButtonElement = document.getElementById("submit"),
                addResult = document.getElementById ("add-result"),

                modalElement = document.getElementById("productInfo"),
                photoElement = document.getElementById("imageUrl"),
                discountElement = document.getElementById("discount"),
                ratingElement = document.getElementById("rating"),
                descriptionElement = document.getElementById("description");


        // READ - kiekvieno produkto atvaizdavimas lenteleje
        const getTableContents = () => {
				let dynamicHTML = ``;
            // Einamasis vienas objektas "product" imtas is masyvo "products" ir ciklas kartojasi 30kartu
            for (const product of products) {
                //Yra sukuriamas papildomai delete button (tik cia) ir jam priskiriama delete funkcija. Button duoda nuorodo i button id kuri reikia istrinti. Id lieka unikalus visada.
                //Yyra sukuriamas papildomai update button (tik cia) ir jam priskiriama setEdit funkcija. Kai nusetinsime editinima kazkuriam produktui - tada visas reiskmes is produkto perkeliamos i imputus.
					dynamicHTML += `<tr>
						<td onclick="showaModal(${product.id})">${product.id}</td>
						<td>${product.title}</td>
						<td>${product.price}</td>
						<td>${product.stock}</td>
						<td>${product.brand}</td>
						<td>${product.category}</td>
                        <td>
                            <button class="btn btn-default" id="delete" onclick="deleteProduct(${product.id})"style="margin-bottom: 3px;">Delete</button>
                            <button class="btn btn-default" id="update" onclick="setEdit(${product.id})" style="margin-bottom: 3px;">Update</button>
                        </td>
                </tr>`;
            }  
            // ideti ciklo rezultata i html (console.log ([dynamicDataElement]));
            dynamicDataElement.innerHTML = dynamicHTML; //jeigu prideti += tada prisides EXAMPLE eilute
        };
 
        // kad funkcija suveiktu ja reikia iskviesti (yra galimas automatinis funckijos sikvietimas apskliaudus funkcija ir uz jos ribu padejus skliaustelius).
        getTableContents ();

        //visas produkto objektas kuri bus tvaizduojamas lange
        const showaModal = (id) =>{
            let elementIndex = products.findIndex((value) => value.id === id); //gausime elemento indeksa (pozicija) masyve,
            const product = products[elementIndex];
            modalElement.showModal();
        }

        // CREATE - funkcija sukuria nauja objekta i kuri isides input reiksmes 
        const createNewRecord = (event) => {
            //event.PreventDefault - kad puslapis nepersikrautu (dazniausiai naudojama su formomis kai nera nurodytas button type: button, nes tada automatiskai buna submit ir persikrauna)
            event.preventDefault(); //console.log (event);
				const newProduct = {
					id: currentId,  //kiekvinas naujas pridetas elementas tures vis didesni id priklausomai nuo paskutnio elemento id.
					title: titleInputElement.value,
                    description: descriptionElement.value,
					price: + priceInputElement.value, //kad nebutu stringas
                    discountPrecentage: +discountElement.value, //kad nebutu stringas
                    rating: +ratingElement.value,
					stock: +stockInputElement.value,
					brand: brandInputElement.value,
					category: categoryInputElement.value,
                    thumbnail: photoElement.value
				};
                currentId++;

                    // Get input values for validation:
                    const title = titleInputElement.value;
                    const price = priceInputElement.value;
                    const stock = stockInputElement.value;
                    const brand = brandInputElement.value;
                    const category = categoryInputElement.value;
                    // console.log(title), console.log(price), console.log(stock), console.log(brand), console.log(category)

                   // Validations:
                if (!title || !price || !stock || !brand || !category) {
                    addResult.innerText = (`Something is missing....\n Please, fill in the complete form!`)
                    addResult.style.display = 'block';
                    addResult.style.backgroundColor = '#cf7a847f';
                    return;
                } else {
                    addResult.style.display = 'none';
                }

                if (!/^\d+$/.test(price) ||  !/^\d+$/.test(stock) || category == "") {
                    addResult.innerText = (`Invalid input.\n Please use only letters for title/brand, numbers for price/stock and don't forget to choose category!`);
                    addResult.style.display = 'block';
                    addResult.style.backgroundColor = '#cf7a847f';
                    return;
                } else {
                    addResult.style.display = 'none';
                }

                if (category === '' || category === 'Choose...') {
                    addResult.innerText =  ('Please select a category!');
                    addResult.style.display = 'block';
                    addResult.style.backgroundColor = '#cf7a847f';
                    return;
                } else {
                    addResult.style.display = 'none';
                }

                // Validations: Duplicate product check is performed based on product details.
                const duplicateProduct = products.find((existingProduct) =>
                existingProduct.title.toLowerCase() === newProduct.title.toLowerCase() &&
                existingProduct.price === newProduct.price &&
                existingProduct.stock === newProduct.stock &&
                existingProduct.brand.toLowerCase() === newProduct.brand.toLowerCase() &&
                existingProduct.category === newProduct.category
                );

                if (duplicateProduct) {
                addResult.innerText = `A product with the same details already exists!`;
                addResult.style.display = 'block';
                addResult.style.backgroundColor = '#cf7a847f';
                return;
                }

                // prie "products" masyvo prideti nauja produkta
                products.push(newProduct);

                // palikti inputus tuscius
                    titleInputElement.value = "";
                    priceInputElement.value = "";
                    stockInputElement.value = "";
                    brandInputElement.value = "";
                    categoryInputElement.value = "";
        
                //Pakeisti alert teksta
                addResult.style.display = 'block';
                addResult.innerText = 'New element has been successfully added!';
                //kad pakeisti spalva
                addResult.style.backgroundColor = '#76cd7e7f';

                localStorage.setItem("products", JSON.stringify(products));

                // kad table atsinajunitu su naujU elementu, reikia vel iskviesti atvaizdavimo funkcija
                getTableContents();
        }; 

        // Kai mygtukas yra spaudziamas - issikviecia funkcija
        submitButtonElement.onclick = createNewRecord;

        // DELETE - Sukurti nuaja delete button ir istrina elementa pagal jo id(parametras)
        const deleteProduct = (id) => {
            // Unikalus/nesikartojantis ID. kad suzinoti elemento vieta masyve - naudoti findindex. Funkcija("value"- kiekvieno producto reiksme): joje ieskome produkto kurio id atitnka auksciau(deleteProducts) nurodyta id.
            let elementIndex = products.findIndex(value=>value.id === id);
            // console.log(elementIndex); 
            products.splice(elementIndex,1);

            //Pakeisti alert teksta
            addResult.style.display = 'block';
            addResult.innerText = 'Selected element has been successfully deleted!';
            //kad pakeisti spalva
            addResult.style.backgroundColor = '#76cd7e7f';

            localStorage.setItem("products", JSON.stringify(products));

            // kad table atsinajunitu su istrintu elementu, reikia vel iskviesti atvaizdavimo funkcija
             getTableContents();
        };
 
        // UPDATE - Sukurti nuaja update button
        // Svarbus prie update: kai neesame update rezime (nepaspaustas mygtukas) tada yra false. Kaip paspaudziam, rezimas keiciasi i "true".
        let editMode = false; 
        let currentProduct;

        // Back to Initial state: kai updatinimas bus baigtas, grizti prie default vaizdo
        const updateProduct = (event)=>{
            event.preventDefault();
            //reiskme bus tokia kokia inpute
            products [currentProduct].title = titleInputElement.value;
            products [currentProduct].price = priceInputElement.value;
            products [currentProduct].stock = stockInputElement.value;
            products [currentProduct].brand = brandInputElement.value;
            products [currentProduct].category = categoryInputElement.value;

            // updated values for validation
            const updatedTitle = products[currentProduct].title;
            const updatedPrice = products[currentProduct].price;
            const updatedStock = products[currentProduct].stock;
            const updatedBrand = products[currentProduct].brand;
            const updatedCategory = products[currentProduct].category;

                // Validations:
                if (!updatedTitle || !updatedPrice || !updatedStock || !updatedBrand || !updatedCategory) {
                addResult.innerText = (`Something is missing....\n Please, fill in the complete form!`)
                addResult.style.display = 'block';
                addResult.style.backgroundColor = '#cf7a847f';
                return;
                } else {
                    addResult.style.display = 'none';
                }

                if (!/^\d+$/.test(updatedPrice) ||  !/^\d+$/.test(updatedStock) || category == "" || updatedCategory === 'Choose...') {
                    addResult.innerText = (`Invalid input.\n Please use only letters for title/brand, numbers for price/stock and don't forget to choose category!`);
                    addResult.style.display = 'block';
                    addResult.style.backgroundColor = '#cf7a847f';
                    return;
                } else {
                    addResult.style.display = 'none';
                }

            currentProduct = undefined;
            editMode = false; 
            submitButtonElement.onclick = createNewRecord;
            //Pakeisti mygtuko teksta
            submitButtonElement.innerText = 'Submit';
            //kad pakeisti naujo update button spalva (per klase- submitButtonElement.classList.add/remove('btn-primary');
            submitButtonElement.style.backgroundColor = 'rgba(87, 191, 232, 0.712)';

            // palikti inputus tuscius
            titleInputElement.value = "";
            priceInputElement.value = "";
            stockInputElement.value = "";
            brandInputElement.value = "";
            categoryInputElement.value = "";

             //Pakeisti alert teksta
             addResult.style.display = 'block';
            addResult.innerText = 'Selected element has been successfully updated!';
            //kad pakeisti spalva
            addResult.style.backgroundColor = '#76cd7e7f';

            localStorage.setItem("products", JSON.stringify(products));

            getTableContents();
        };

        // Edit state: elemento atnaujinimas. Bus editinamas tam tikras produktas ir jo id yra (id):
        const setEdit = (id) => {
            //suradome to produkto indeksa masyve (pagal id)
            let elementIndex = products.findIndex(value=>value.id === id);
            //gauti pati produkta(jo reiksme). Pagal indeksa susirandame kuris produktas bus redaguojamas
            const product = products[elementIndex]; //console.log(product)
            //kad visos reiksmes is pasirinkto produkto atsirastu inpute
            titleInputElement.value = product.title;
            priceInputElement.value = product.price;
            stockInputElement.value = product.stock;
            brandInputElement.value = product.brand;
            categoryInputElement.value = product.category;

            //Pakeisti mygtuko teksta
            submitButtonElement.innerText = 'Update';
            //kad pakeisti naujo update button spalva (per klase-  submitButtonElement.classList.add/remove('btn-primary');
            submitButtonElement.style.backgroundColor = 'rgba(177, 111, 177, 0.805)';
            //priskirti mygtukui funkcija
            submitButtonElement.onclick = updateProduct;

            //elemento pozicija masyva kuria redaguosim
            currentProduct = elementIndex; 

            editMode = true; 
        };
    </script>
</body>
</html>



